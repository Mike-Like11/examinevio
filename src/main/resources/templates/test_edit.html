<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>My first BootstrapVue app</title>
    <link
            type="text/css"
            rel="stylesheet"
            href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"
    />
    <link
            type="text/css"
            rel="stylesheet"
            href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
    />
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"></script>

    <script src="https://unpkg.com/vue@latest/dist/vue.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.min.css" rel="stylesheet">
    <th:block th:include="general.html :: headerfiles"></th:block>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<header th:insert="general.html :: header"> </header>
<div id="app">
    <div class="container" style="margin-top: 10px; margin-bottom: 10px;">
        <div class="card mb-2">
            <div class="card-body">
                <form>
                    <h3>Информация о тесте</h3>
                    <div class="form-icon">
                        <span><i class="icon icon-pencil"></i></span>
                    </div>
                    <div class="form-group">
                        <label>Название раздела теста</label>
                        <input type="text" class="form-control item" v-model="test.name_chapter" disabled id="chapter_test" placeholder="Название раздела теста">
                    </div>
                    <div class="form-group">
                        <label>Название теста</label>
                        <input type="text" class="form-control item" v-model="test.name_test" disabled id="name_test" placeholder="Название теста">
                    </div>
                    <div class="form-group">
                        <label>Дата тестирования</label>
                        <input type="text" class="form-control item" v-model="test.date" disabled placeholder="Дата тестирования">
                    </div>
                    <div class="form-group">
                        <label>Дата тестирования</label>
                        <input type="text" class="form-control item" v-model="test.date" disabled placeholder="Дата тестирования">
                    </div>
                    <div class="form-group">
                        <label>Количество вопросов</label>
                        <input type="text" class="form-control item" v-model="test.question_number" disabled placeholder="Количество вопросов">
                    </div>
                </form>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-12 col-md-6 col-lg-10">
                        <h3>Банк вопросов</h3>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-2">
                        <button type="button" class="btn btn-outline waves-effect px-3" onclick="createAnswer()">
                            <i class="fas fa-plus" aria-hidden="true"><h5>Вопрос</h5></i></button>
                    </div>
                </div>
                <form class="new_answer m-2" style="border-color: white; border-radius: 20px; border-width: 10px" v-on:submit.prevent="postQuestion">
                    <h5>Новый вопрос</h5>
                    <div class="form-group">
                        <label >Напишите номер вопроса в тесте</label>
                        <b-form-select v-model="selected" :options="options"></b-form-select>
                    </div>
                    <div class="form-group">
                        <label>Напишите описание вопроса</label>
                        <b-form-textarea
                                id="textarea"
                                v-model="question_desc"
                                placeholder="Описание вопроса"
                                rows="3"
                                max-rows="6"
                        ></b-form-textarea>
                    </div>
                    <div>
                        <label>Напишите правильный вариант</label>
                        <input type="text" class="form-control item" v-model="answer" id="chapter_test" placeholder="Номер вопроса">
                    </div>
                    <div class="form-group">
                        <input type="submit" class="btn btn-block create-account" value="Добавить">
                    </div>
                </form>
                <b-table striped hover :items="this.test.questions" :fields="this.fields"></b-table>
            </div>
        </div>
    </div>
</div>
<script>
    $('.new_answer').hide();
    function createAnswer() {
        $('.new_answer').toggle();
    }
    window.app = new Vue({
        el: '#app',
        data: {
            fields: [
                {
                    key: 'desc',
                    sortable: true
                },
                {
                    key: 'type',
                    sortable: true
                },
                {
                    key: 'answer',
                    sortable: true,
                }
            ],
            test:'',
            selected:'',
            answer: '',
            question_desc: ' ',
            options:[],
            id : window.location.href.split("/").slice(-1)[0]
        },
        mounted(){
            this.getInfo();
        },
        methods: {
            getInfo: function (event) {
                axios
                    .get("/tests/"+this.id)
                    .then(response => {
                        console.log(response.data.id.str)
                        this.test = response.data;
                        for(let i = 0; i < this.test.question_number; i++){
                            this.options.push(i+1);
                        }
                    })
            },
            postQuestion: function (event) {
                axios
                    .post("/add_question/"+this.id, {
                        "desc": this.question_desc,
                        "type":this.selected,
                        "answer":this.answer,
                    }).then(test=>{
                            this.getInfo();
                    }
                );
                this.selected='';
                this.answer='';
                this.question_desc= ' ';
                createAnswer();
            }
        }
    })
</script>
</body>
</html>